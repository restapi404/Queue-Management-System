{% extends 'base.html' %}
{% load static %}

{% block title %}Queue Status{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
  <h2 class="text-2xl font-bold text-gray-900 mb-6">Live Queue Status</h2>
  <div id="queue-status" class="bg-white rounded-lg shadow-lg p-6 space-y-4">
    <div class="flex justify-between items-center">
      <span class="text-gray-600">Your Token:</span>
      <span class="text-2xl font-bold text-blue-600">{{ token.token_number }}</span>
    </div>

    <div class="flex justify-between items-center">
      <span class="text-gray-600">Current Serving:</span>
      <span id="current-serving" class="text-2xl font-bold text-green-600">{% if current_serving %}{{ current_serving.token_number }}{% else %}--{% endif %}</span>
    </div>

    <div class="flex justify-between items-center">
      <span class="text-gray-600">Tokens Ahead:</span>
      <span id="tokens-ahead" class="text-xl font-semibold text-gray-900">{{ tokens_ahead }}</span>
    </div>

    <div class="flex justify-between items-center">
      <span class="text-gray-600">Estimated Wait:</span>
      <span id="est-wait" class="text-xl font-semibold text-gray-900">{{ est_wait }} minutes</span>
    </div>

    <div class="flex justify-between items-center">
      <span class="text-gray-600">Status:</span>
      <span id="your-status">
        {% if token.is_served %}
          <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">Served</span>
        {% else %}
          <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">Waiting</span>
        {% endif %}
      </span>
    </div>
  </div>

  <div class="mt-6 text-center">
    <a href="{% url 'home' %}" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200">Back to Home</a>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  // Real-time AJAX polling for status
  setInterval(function() {
    $.ajax({
      url: window.location.pathname,
      headers: {'X-Requested-With': 'XMLHttpRequest'},
      dataType: "json",
      success: function(data) {
        $("#current-serving").text(data.current_serving || '--');
        $("#tokens-ahead").text(data.tokens_ahead);
        $("#est-wait").text(data.est_wait);
        if (data.tokens_ahead === 0) {
          $("#your-status").html('<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">Next</span>');
        }
      }
    });
  }, 3000); // Every 3 seconds
</script>
{% endblock %}